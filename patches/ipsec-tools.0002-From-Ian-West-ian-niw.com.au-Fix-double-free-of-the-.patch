From dd4ed1b2a5a3e06c045365c76aa7f0b27fee7ff7 Mon Sep 17 00:00:00 2001
From: tteras <tteras>
Date: Tue, 5 Feb 2013 06:23:42 +0000
Subject: [PATCH 2/9] From Ian West <ian@niw.com.au>: Fix double free of the
 radius info on config reload.

---
 src/racoon/isakmp_xauth.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/racoon/isakmp_xauth.c b/src/racoon/isakmp_xauth.c
index 853caaa..94c72d6 100644
--- a/src/racoon/isakmp_xauth.c
+++ b/src/racoon/isakmp_xauth.c
@@ -1,4 +1,4 @@
-/*	$NetBSD: isakmp_xauth.c,v 1.22 2011/03/14 15:50:36 vanhu Exp $	*/
+/*	$NetBSD: isakmp_xauth.c,v 1.22.2.1 2013/02/05 06:23:42 tteras Exp $	*/
 
 /* Id: isakmp_xauth.c,v 1.38 2006/08/22 18:17:17 manubsd Exp */
 
@@ -461,10 +461,14 @@ xauth_radius_init_conf(int free)
 			vfree(xauth_rad_config.acct_server_list[i].host);
 			vfree(xauth_rad_config.acct_server_list[i].secret);
 		}
-		if (radius_auth_state != NULL)
+		if (radius_auth_state != NULL) {
 			rad_close(radius_auth_state);
-		if (radius_acct_state != NULL)
+			radius_auth_state = NULL;
+		}
+		if (radius_acct_state != NULL) {
 			rad_close(radius_acct_state);
+			radius_acct_state = NULL;
+		}
 	}
 
 	/* initialize radius config */
-- 
1.8.4.3

