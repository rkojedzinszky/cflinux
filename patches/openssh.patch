--- openssh-3.8p1/Makefile.in.orig	Thu Mar 18 09:32:51 2004
+++ openssh-3.8p1/Makefile.in	Thu Mar 18 09:33:56 2004
@@ -127,45 +127,44 @@
 	(cd openbsd-compat && $(MAKE))
 always:
 
-libssh.a: $(LIBSSH_OBJS)
-	$(AR) rv $@ $(LIBSSH_OBJS)
-	$(RANLIB) $@
+libssh.so: $(LIBSSH_OBJS)
+	$(LD) -o $@ -shared $(LIBSSH_OBJS)
 
-ssh$(EXEEXT): $(LIBCOMPAT) libssh.a $(SSHOBJS)
+ssh$(EXEEXT): $(LIBCOMPAT) libssh.so $(SSHOBJS)
 	$(LD) -o $@ $(SSHOBJS) $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-sshd$(EXEEXT): libssh.a	$(LIBCOMPAT) $(SSHDOBJS)
+sshd$(EXEEXT): libssh.so	$(LIBCOMPAT) $(SSHDOBJS)
 	$(LD) -o $@ $(SSHDOBJS) $(LDFLAGS) -lssh -lopenbsd-compat $(LIBWRAP) $(LIBPAM) $(LIBS)
 
-scp$(EXEEXT): $(LIBCOMPAT) libssh.a scp.o progressmeter.o
+scp$(EXEEXT): $(LIBCOMPAT) libssh.so scp.o progressmeter.o
 	$(LD) -o $@ scp.o progressmeter.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-add$(EXEEXT): $(LIBCOMPAT) libssh.a ssh-add.o
+ssh-add$(EXEEXT): $(LIBCOMPAT) libssh.so ssh-add.o
 	$(LD) -o $@ ssh-add.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-agent$(EXEEXT): $(LIBCOMPAT) libssh.a ssh-agent.o
+ssh-agent$(EXEEXT): $(LIBCOMPAT) libssh.so ssh-agent.o
 	$(LD) -o $@ ssh-agent.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-keygen$(EXEEXT): $(LIBCOMPAT) libssh.a ssh-keygen.o
+ssh-keygen$(EXEEXT): $(LIBCOMPAT) libssh.so ssh-keygen.o
 	$(LD) -o $@ ssh-keygen.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-keysign$(EXEEXT): $(LIBCOMPAT) libssh.a ssh-keysign.o
+ssh-keysign$(EXEEXT): $(LIBCOMPAT) libssh.so ssh-keysign.o
 	$(LD) -o $@ ssh-keysign.o readconf.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-keyscan$(EXEEXT): $(LIBCOMPAT) libssh.a ssh-keyscan.o
+ssh-keyscan$(EXEEXT): $(LIBCOMPAT) libssh.so ssh-keyscan.o
 	$(LD) -o $@ ssh-keyscan.o $(LDFLAGS) -lssh -lopenbsd-compat -lssh $(LIBS)
 
-sftp-server$(EXEEXT): $(LIBCOMPAT) libssh.a sftp.o sftp-common.o sftp-server.o
+sftp-server$(EXEEXT): $(LIBCOMPAT) libssh.so sftp.o sftp-common.o sftp-server.o
 	$(LD) -o $@ sftp-server.o sftp-common.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-sftp$(EXEEXT): $(LIBCOMPAT) libssh.a sftp.o sftp-client.o sftp-common.o sftp-glob.o progressmeter.o
+sftp$(EXEEXT): $(LIBCOMPAT) libssh.so sftp.o sftp-client.o sftp-common.o sftp-glob.o progressmeter.o
 	$(LD) -o $@ progressmeter.o sftp.o sftp-client.o sftp-common.o sftp-glob.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
-ssh-rand-helper${EXEEXT}: $(LIBCOMPAT) libssh.a ssh-rand-helper.o
+ssh-rand-helper${EXEEXT}: $(LIBCOMPAT) libssh.so ssh-rand-helper.o
 	$(LD) -o $@ ssh-rand-helper.o $(LDFLAGS) -lssh -lopenbsd-compat $(LIBS)
 
 # test driver for the loginrec code - not built by default
-logintest: logintest.o $(LIBCOMPAT) libssh.a loginrec.o
+logintest: logintest.o $(LIBCOMPAT) libssh.so loginrec.o
 	$(LD) -o $@ logintest.o $(LDFLAGS) loginrec.o -lopenbsd-compat -lssh $(LIBS)
 
 $(MANPAGES): $(MANPAGES_IN)
--- openssh-3.8p1/configure.orig	Thu Mar 18 09:38:41 2004
+++ openssh-3.8p1/configure	Thu Mar 18 09:39:47 2004
@@ -1891,7 +1891,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:1893: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:1895: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -3597,7 +3597,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:3599: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:3601: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4865,7 +4865,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:4867: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:4869: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5455,7 +5455,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:5457: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:5459: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5981,7 +5981,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:5983: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:5985: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -6679,7 +6679,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:6681: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:6683: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -6744,7 +6744,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:6746: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:6748: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -7265,7 +7265,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:7267: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:7269: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -7777,7 +7777,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:7779: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:7781: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -7890,7 +7890,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:7892: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:7894: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8527,7 +8527,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:8529: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:8531: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8583,7 +8583,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:8585: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:8587: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8659,7 +8659,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:8661: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:8663: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -8822,7 +8822,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:8824: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:8826: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -9354,7 +9354,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:9356: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:9358: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -9417,7 +9417,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:9419: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:9421: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -9465,7 +9465,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:9467: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:9469: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -9640,7 +9640,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:9642: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:9644: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -10736,7 +10736,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:10738: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:10740: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -10973,7 +10973,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:10975: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:10977: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -11210,7 +11210,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:11212: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:11214: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -11447,7 +11447,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:11449: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:11451: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -11684,7 +11684,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:11686: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:11688: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -13186,7 +13186,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:13188: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:13190: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -14224,7 +14224,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:14226: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:14228: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -14284,7 +14284,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:14286: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:14288: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -16460,7 +16460,7 @@
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:16462: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='LD_LIBRARY_PATH=${UC_ROOT}/lib ./conftest$ac_exeext'
   { (eval echo "$as_me:16464: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
